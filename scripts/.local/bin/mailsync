#!/bin/sh

set -e

mailmove || true  # move archived mails from inbox to archive

if [ ! "$1" = "retag" ]; then
	GPASS="${GOOGLE_PASSWORD:-$(keypuller)}"
	GOOGLE_PASSWORD="$GPASS" mbsync -a ||
		(touch /tmp/mailpullfailed && exit 1)
	[ -f /tmp/mailpullfailed ] && rm /tmp/mailpullfailed
fi

mailtag  # tag stuff with notmuch

# refresh tmux
tmux refresh-client -S
